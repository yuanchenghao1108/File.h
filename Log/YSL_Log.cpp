// -------------------------------------------------------------------------------
#include "YSL_Log.h"
#include "..\\errortype\err_type.h"
// -------------------------------------------------------------------------------

// -------------------------------------------------------------------------------
YSL_Log::YSL_Log(LogLevel level,const char* filename) {
	// -----------------------------------------------------
	_init_all_ptr();
	// -----------------------------------------------------
	_init_all_vars(true);
	// -----------------------------------------------------
	pAppend = new FileAppender(filename);
	// -----------------------------------------------------
	pLogger = Logger::getInstance("Test");
	// -----------------------------------------------------
	pAppend->setLayout(std::unique_ptr<Layout>(new PatternLayout(str_Pattern)));
	// -----------------------------------------------------
	pLogger.addAppender(pAppend);
	// -----------------------------------------------------
	pLogger.setLogLevel(level);
	// -----------------------------------------------------
	pBuff = new char[M_MAX_BUFF_SIZE];
	memset(pBuff, 0, M_MAX_BUFF_SIZE);
	// -----------------------------------------------------
}

// -------------------------------------------------------------------------------
YSL_Log::~YSL_Log() {
	// -----------------------------------------------------
	if (pBuff) {
		delete[] pBuff;
	}
	// -----------------------------------------------------
}

// -------------------------------------------------------------------------------
void __fastcall YSL_Log::_init_all_vars(bool isfirst) {
	// -----------------------------------------------------
	if (isfirst) {
	
	}
	// -----------------------------------------------------
	str_Pattern = LOG4CPLUS_TEXT("%D{%Y-%m-%d %H:%M:%S} [%t] <%-5p:> %m (%b:%L)%n");//2021-01-29 23:33:56 [14200] <WARN :> Warning (ysl_log.cpp:22)
	// -----------------------------------------------------
	vError = ERR_SUCCESS;
	// -----------------------------------------------------
}

// -------------------------------------------------------------------------------
void __fastcall YSL_Log::_init_all_ptr(void) {
	// -----------------------------------------------------
	pAppend = NULL;
	pBuff = NULL;
	// -----------------------------------------------------
}

// -------------------------------------------------------------------------------
#pragma warning(disable : 4996) 
void __fastcall YSL_Log::_set_log_text(const char* fmt, ...) {
	// -----------------------------------------------------
	va_list ap;
	memset(pBuff, 0, strlen(pBuff));
	// -----------------------------------------------------
	try {
		va_start(ap, fmt);;
		_vsnprintf(pBuff, M_MAX_BUFF_SIZE, fmt, ap);
	}
	catch (...) {
		va_end(ap);
	}
	// -----------------------------------------------------
	va_end(ap);
	// -----------------------------------------------------
}

#pragma warning(suppress : 4996) 
// -------------------------------------------------------------------------------
//End Of File